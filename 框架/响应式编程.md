[TOC]

# 响应式编程(Reactive Programming)

响应式编程是一种面向数据流和变化传播的编程范式

## 流的概念
看到一篇博文说，一切都可以视为流，事件、数据、请求和响应等等，这些是一些常见的可以抽象为流的事物，还有其他的一些隐形的，不太容易想的事物，也可以抽象为流来处理（具体例子，还没想到，想到了补上！）。总体上如果一个事物可以抽象为流，那它至少从一个方面来说，有下面四个特点（个人总结，仅供参考）：

1、可以分割为有限个部分

2、处理时不用实时顺序的返回结果（非阻塞，异步处理）

3、对每个部分可以进行相同的操作，并且可以进行多次

4、每个部分和其他部分可以进行聚合处理

## java中对响应式编程的抽象
在java的世界里，有许多框架对响应式编程进行了抽象，今天我们用reactivestreams来举例说明。

响应式编程范式中，有四个角色，分别是：publisher、subscriber、subscription和processor。下面分别说明一下：

### Publisher
Publisher只有一个方法，即subscribe，用来增加对数据流的监听者，即subscriber。

### Subscriber
Subscriber是真正去响应事件和处理数据的角色，通过上面的方法监听事件或者数据的到来，然后进行响应的处理。在该接口中有四个方法，分别是：

- onNext()  获取到数据后，进行处理数据

- onComplete()  当数据流处理完成时，回调

- onError()  发生错误时，回调

- onSubscribe()  监听后，获取数据

### Subscription
Subscription是实际从Publisher中获取数据的角色，在reactivestreams框架中，有两个方法约束：

request(long n) 请求n个数据，在实际使用中，request来负责调用Subcriber的三个回调方法，分别是：onComplete，onError和onNext。

cancel() 取消请求

### Processor
Processor同时继承了Publisher和Subcriber，意味着它既是数据的发布者又是数据的消费者，充当两者场景交换的桥梁，如果在实际的应用场景中出现了需要同时发布者和消费者两个角色的对象是，就可以使用该接口来定义，便于随时转换角色。

思考点
1、响应式编程，是对流的处理方式，通过将事物抽象为流，然后就可以通过响应式这套范式来对它进行处理。

2、上面的抽象接口，是对流的处理机制做了抽象，而非对流本身做抽象，日常中一说到响应式就想到流，总有一种响应式就是流的错觉。

3、这个框架关注的式数据准备好之后，对数据的处理机制，至于数据从哪里来以及怎么组织，并未涉及，所以理论上来说，这个机制可以处理任何事物。

4、还有一点，就是我注意到了它对响应式的抽象过程，将获取数据的过程，单独作为一个接口进行抽象，这样就相当于将响应式的机制进行萃取和提纯，机制就是机制，获取数据其实是一个机制之外的动作，从而使对机制的抽象层次更高。

## 回压（Backpressure）

这里要特别要提一下回压（Backpressure）, Backpressure 其实是一种现象,在数据流从上游生产者向下游消费者传输的过程中，上游生产速度大于下游消费速度，导致下游的 Buffer 溢出，这种现象就叫做 Backpressure 出现。这句话的重点不在于”上游生产速度大于下游消费速度”，而在于”Buffer 溢出”。回压和 Buffer 是一对相生共存的概念，只有设置了 Buffer，才有回压出现；只要设置了 Buffer，一定存在出现回压的风险。

比如我们开发一个后端服务，有一个 Socket 不断地接收来自用户的请求来把用户需要的数据返回给用户。我们服务所能承受的同时访问用户数是有上限的，假设最多只能承受 10000 的并发，再多的话服务器就有当掉的风险了。对于超过 10000 的用户，程序会直接丢弃。那么对于这个案例 10000 就是我们设置的 Buffer，当超过 10000 的请求产生时，就造成了回压的产生；而我们程序的丢弃行为，就是对于回压的处理。

对于回压我们一般有两种处理方式，一种就是上面举例中的拒绝或丢弃，这是否定应答的方式，另一种是肯定应答，先收下来，然后再慢慢处理。
